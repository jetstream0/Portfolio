<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Retro">
    <meta name="description" content="The retro version of my website.">
    <title>Retro</title>
    <link rel="icon" type="image/x-icon" href="/tiny-favicon.png" />
    <link href="retro.css" rel="stylesheet" type="text/css" />
    <!--To do: update my opinon site-->
    <!--<meta http-equiv="Onion-Location" content="http://eecflincupi352qlelnar7ahghmhrmiqil4p5cwjwimidsrwqxtlhbyd.onion/retro">-->
  </head>
  <body>
    <div id="desktop">
      <div class="window" id="start-window" style="left: 35px; top: 35px;">
        <div class="window-top">
          <div class="window-title">
            <span>Start</span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <h2 id="welcome-h">Welcome to my <span id="www">World Wide Web</span> page!</h2>
          <div id="start-grid">
            <div id="start-intro">
              <h3>Hola, I'm Prussia</h3>
              <p>I like programming. And websites.</p>
              <p>Not sure what else to say here. Oh, this webpage is inspired by Windows NT and zutomayo.net.</p>
              <noscript>Your Javascript is disabled btw. That's fine but don't expect any of the buttons to work :)</noscript>
            </div>
            <div id="start-buttons">
              <h3>Stuff I like:</h3>
              <ul id="stuff-i-like">
                <li><button class="button-base outer-facing" onclick="open_window(event, 'Music')">Music</button></li>
                <li><button class="button-base outer-facing" onclick="open_window(event, 'Wikipedia')">Wikipedia</button></li>
                <li><button class="button-base outer-facing" onclick="open_window(event, 'Programming')">Programming</button></li>
                <li><button class="button-base outer-facing" onclick="open_window(event, 'Minesweeper')">Minesweeper</button></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="window" id="music-window" style="left: 155px; top: 75px;">
        <div class="window-top">
          <div class="window-title">
            <span>Music</span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <h2>Some songs I like</h2>
          <div id="music-container">
            <div class="song">
              <div class="album-cover-container">
                <img src="album-covers/hisohiso-banashi.png" title="Hisohiso Banashi - I do not own the album cover image yada yada"/>
              </div>
              <div class="song-info">
                <h4><ruby>グラスとラムレーズン<rp>(</rp><rt>Glass to Rum Raisin</rt><rp>)</rp></ruby></h4>
                <span class="song-artist" title="hint1">by Zutomayo</span>
                <p>Some more by the same artist: "JK Bomber", "Inemuri Enseitai", "Samayoi Yoi Ondo", "Inner Heart"</p>
              </div>
            </div>
            <div class="song">
              <div class="album-cover-container">
                <img src="album-covers/dakara-boku-wa-ongaku-wo-yameta.png" title="Dakara Boku wa Ongaku wo Yameta - I do not own the album cover image yada yada"/>
              </div>
              <div class="song-info">
                <h4><ruby>五月は花緑青の窓辺から<rp>(</rp><rt>Gogatsu wa Hanarokushou no Madobe kara</rt><rp>)</rp></ruby></h4>
                <span class="song-artist">by Yorushika</span>
                <p>Some more by the same artist: "Robber and Bouquet", "Voice", "The Old Man and the Sea", "Hitchcock"</p>
              </div>
            </div>
            <div class="song">
              <div class="album-cover-container">
                <img src="album-covers/odds-and-ends.png" title="Odds and Ends - I do not own the album cover image yada yada"/>
              </div>
              <div class="song-info">
                <h4><ruby>夜間飛行<rp>(</rp><rt>Yakanhikou</rt><rp>)</rp></ruby></h4>
                <span class="song-artist">by Nishina</span>
                <p>Some more by the same artist: "Ainikoi", "Tokyo Marble", "Kedamono no Friends", "Yoruninatte"</p>
              </div>
            </div>
            <div class="song">
              <div class="album-cover-container">
                <img src="album-covers/spd-gar.png" title="Spd Gar - I do not own the album cover image yada yada"/>
              </div>
              <div class="song-info">
                <h4>Don't You Want Me</h4>
                <span class="song-artist">by PSYQUI</span>
                <p>Some more by the same artist: "Raise Your Hands", "Endroll", "Funk Assembly", "Education"</p>
              </div>
            </div>
            <div class="song">
              <div class="album-cover-container">
                <img src="album-covers/we-have-fed-you-all-a-thousand-years.png" title="We Have Fed You All A Thousand Years - I do not own the album cover image yada yada"/>
              </div>
              <div class="song-info">
                <h4>The Preacher and the Slave</h4>
                <span>performed by Utah Phillips</span>
                <p>Some more by the same artist: "Bread and Roses", "Halleluja, I'm a Bum", "The Popular Wobbly", "Solidarity Forever"</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="window" id="wikipedia-window" style="left: 45px; top: 65px;">
        <div class="window-top">
          <div class="window-title">
            <span>Wikipedia<span id="wikipedia-hidden">hint2 2023 27th jan did you know ww1</span></span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <iframe id="wikipedia-iframe"></iframe>
        </div>
      </div>
      <div class="window" id="programming-window" style="left: 95px; top: 65px;">
        <div class="window-top">
          <div class="window-title">
            <span>Programming</span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <h2>Programming stuff</h2>
          <p>My favourite language at the moment is <b>Typescript</b>, but I'm pretty familiar with Rust, Python, and obviously HTML/CSS/JS. I also know a bit of Ruby and Solidity.</p>
          <p>Most of my projects can be found on my <a href="https://github.com/jetstream0">Github</a> or the <a href="/">main page</a> of my website, and you can hire me <a href="/sample">here</a>.</p>
          <hr/>
          <p>For fun, here are some recreated Window NT programs:</p>
          <div id="programs-list">
            <button class="button-base outer-facing" onclick="open_window(event, 'Terminal')">Terminal</button>
          </div>
        </div>
      </div>
      <div class="window" id="minesweeper-window" style="left: 15px; top: 105px;">
        <div class="window-top">
          <div class="window-title">
            <span>Minesweeper</span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <h2>WIP</h2>
        </div>
      </div>
      <div class="window" id="terminal-window" style="left: 25px; top: 85px;">
        <div class="window-top">
          <div class="window-title">
            <span>Terminal</span>
          </div>
          <div class="window-top-buttons">
            <button class="button-base window-top-button"><span class="button-inside button-x">x</span></button>
          </div>
        </div>
        <div class="window-content">
          <p>Prussia's Terminal [version 0.4.2]</p>
          <p>a joke about copyright here</p>
          <p>type 'help' for help</p>
          <br>
          <div id="terminal-responses">
          </div>
          <div id="terminal-input-container"><span id="current-path">/></span> <input type="text" id="terminal-command-input"/></div>
        </div>
      </div>
      <div id="taskbar">
        <div>
          <div id="taskbar-start" class="outer-facing" title="Click to reopen the Start window">
            <span>Start</span>
          </div>
        </div>
        <div id="taskbar-tabs">
        </div>
        <div id="taskbar-time-container">
          <div id="taskbar-time" class="inner-facing" title="Unrelated to the magazine">
            <span id="time">00:00</span>
          </div>
        </div>
      </div>
    </div>
    <div id="portrait-warning">
      <p>Hey bro! This site doesn't really work in portrait mode.</p>
    </div>
    <script>
      //todo: minesweeper
      //todo: final hint about chinese monkey king after beating minesweeper
      //todo: sudo reward
      //todo: implement desktop shortcuts?

      let current_window = "start";
      let window_z_index = 1;

      function change_current_window(new_window) {
        document.getElementById("taskbar-tabs").querySelectorAll(".inner-facing").forEach((tab) => {
          tab.classList.remove("inner-facing");
          tab.classList.add("outer-facing")
        });
        current_window = new_window;
        document.getElementById("toolbar-tab-"+new_window).classList.add("inner-facing");
        document.getElementById("toolbar-tab-"+new_window).classList.remove("outer-facing");
        window_z_index++;
        document.getElementById(new_window+"-window").style.zIndex = window_z_index;
      }

      //update time
      function refresh_time() {
        let hours = (new Date()).getHours();
        let minutes = (new Date()).getMinutes();
        document.getElementById("time").textContent = `${String(hours).length === 1 ? `0${hours}` : hours}:${String(minutes).length === 1 ? `0${minutes}` : minutes}`;
      }
      refresh_time();
      setInterval(refresh_time, 55000);

      //close buttons
      function recount_taskbar_tabs() {
        let tabs = document.querySelectorAll(".taskbar-tab");
        if (tabs.length < 5) {
          tabs.forEach((tab) => tab.classList.add("taskbar-tab-less-than-5"));
        } else {
          tabs.forEach((tab) => tab.classList.remove("taskbar-tab-less-than-5"));
        }
      }

      document.querySelectorAll(".button-x").forEach((x) => {
        x.parentElement.onclick = () => {
          //hide window
          let window_obj = x.parentElement.parentElement.parentElement.parentElement;
          window_obj.style.display = "none";
          document.getElementById("toolbar-tab-"+window_obj.id.replace("-window", "")).remove();
          recount_taskbar_tabs();
        };
      });

      //drag the window tops
      function px_to_int(px) {
        return Number(px.replace("px", ""));
      }
      function int_to_px(int) {
        return String(int)+"px";
      }
      document.querySelectorAll(".window-top").forEach((top) => {
        let start_window_coords;
        let start_mouse_coords;
        top.onmousedown = (event) => {
          start_mouse_coords = [event.clientX, event.clientY];
          //coords of window
          start_window_coords = [px_to_int(top.parentElement.style.left), px_to_int(top.parentElement.style.top)];
        };
        document.addEventListener("mouseup", () => {
          start_mouse_coords = undefined;
          start_window_coords = undefined;
        });
        document.addEventListener("mousemove", (event) => {
          if (!start_mouse_coords || !start_window_coords) return;
          //change window coords
          let current_mouse_coords = [event.clientX, event.clientY];
          let delta_x = current_mouse_coords[0]-start_mouse_coords[0];
          let delta_y = current_mouse_coords[1]-start_mouse_coords[1];
          let new_window_top = start_window_coords[1]+delta_y;
          top.parentElement.style.left = int_to_px(start_window_coords[0]+delta_x);
          top.parentElement.style.top = int_to_px(new_window_top);
          //don't allow user to drag window below taskbar, and make sure window top is visible
          if (new_window_top > window.innerHeight-38-25) {
            top.parentElement.style.top = `${window.innerHeight-38-25}px`;
          }
          if (new_window_top < 0) {
            top.parentElement.style.top = "0px";
          }
        });
      });

      //window expanding/shrinking
      document.querySelectorAll(".window").forEach((window_obj) => {
        let mouse_down = false;
        let change = false;
        let start_dimensions;
        let start_mouse_coords;
        window_obj.addEventListener("mousemove", (event) => {
          change = false;
          if (event.clientX > px_to_int(window_obj.style.left)+window_obj.offsetWidth-10) {
            document.body.style.cursor = "col-resize";
            change = "x";
          } else if (document.body.style.cursor === "col-resize") {
            if (!mouse_down) {
              document.body.style.cursor = "auto";
              change = false;
            }
            if (mouse_down) {
              window_obj.style.width = int_to_px(start_dimensions[0] + (event.clientX - start_mouse_coords[0]));
            }
          }
          if (event.clientY > px_to_int(window_obj.style.top)+window_obj.offsetHeight-10) {
            document.body.style.cursor = "row-resize";
            change = "y";
          } else if (document.body.style.cursor === "row-resize") {
            if (!mouse_down) {
              document.body.style.cursor = "auto";
              change = false;
            }
            if (mouse_down) {
              window_obj.style.height = int_to_px(start_dimensions[1] + (event.clientY - start_mouse_coords[1]));
            }
          }
        });
        window_obj.addEventListener("mousedown", (event) => {
          if (document.body.style.cursor === "col-resize" || document.body.style.cursor === "row-resize") {
            start_mouse_coords = [event.clientX, event.clientY];
            start_dimensions = [window_obj.offsetWidth, window_obj.offsetHeight];
            mouse_down = true;
          }
        });
        document.addEventListener("mouseup", (event) => {
          mouse_down = false;
          change = false;
          if (document.body.style.cursor === "col-resize" || document.body.style.cursor === "row-resize") {
            document.body.style.cursor = "auto";
          }
        });
        document.addEventListener("mousemove", (event) => {
          if (change === "x" && mouse_down) {
            window_obj.style.width = int_to_px(start_dimensions[0] + (event.clientX - start_mouse_coords[0]));
          } else if (change === "y" && mouse_down) {
            window_obj.style.height = int_to_px(start_dimensions[1] + (event.clientY - start_mouse_coords[1]));
          }
        });
        //also window moving
        window_obj.addEventListener("click", (event) => {
          //ignore if already current window
          if (current_window === window_obj.id.replace("-window", "")) return;
          change_current_window(window_obj.id.replace("-window", ""));
        });
      });

      function create_taskbar_tab(tab_name) {
        let tab = document.createElement("DIV");
        tab.classList.add("taskbar-tab", "inner-facing", "selected-tab");
        tab.id = `toolbar-tab-${tab_name.toLowerCase()}`;
        tab.textContent = tab_name;
        tab.onclick = () => {
          if (tab.classList.contains("outer-facing")) {
            change_current_window(tab_name.toLowerCase());
          }
        };
        document.getElementById("taskbar-tabs").appendChild(tab);
        recount_taskbar_tabs();
      }

      //opening the button window things
      function open_window(event, window_name) {
        let window_obj = document.getElementById(window_name.toLowerCase()+"-window");
        if (window_obj.style.display !== "block") {
          window_obj.style.display = "block";
          create_taskbar_tab(window_name);
          let iframe = document.getElementById("wikipedia-iframe");
          if (window_name.toLowerCase() === "wikipedia" && iframe.src === "") {
            iframe.src = "https://en.wikipedia.org/wiki/Main_Page";
          }
        }
        change_current_window(window_name.toLowerCase());
        if (event) event.stopPropagation();
      }

      let current_path = "/";

      let file_system = {
        "desktop": {
          //
        },
        "documents": {
          "culture": {
            "shogun2.txt": "Great game. Awesome music, fun battles. I'm not too good at it though.",
            "manga.txt": "Nichijou, CITY, Senpai wa Otokonoko",
          },
          "philosophy.txt": "I like open source software, dependencies, and building things from scratch. Were you expecting something deep? Sorry.\nI feel like too much programming is about money. Sure, I get it. Everyone needs it or they'll starve and die. I program for money too. But it sucks. Open source software seems like the cure. Software that is free, accessible, and gives rights to the user is cool, isn't it?\nAnyways, onto dependencies and making things from scratch. I don't like them. It's more interesting building things yourself, and generally results in less bloat and samey looking stuff (looking at you, bootstrap). Obviously I'm no extremist, I do use libraries, especially when things are complex or security/cryptography related. But I feel like it's just more fun to make things from scratch.",
        },
        "music": {
          //
        },
        "dev": {
          "main.rs": "fn main() {\n  println!(\"Hola Mundo\");\n}",
          "hint4.rs": "fn main() {\n  let part_uno: String = String::from_utf8(vec![0b11111011 & 0b01010011, 0b11111001 & 0b01010010, 0b01000000 | 0b01000001, 0b0100111 << 1, 0b11001011 ^ 0b10000010, 0b11011111 & 0b01010011, 0b010010 >> 1 << 3, 0b001 << 5, 0b11111111 & 0b01010011]).unwrap();\n  let part_dos: String = String::from_utf8(vec![0b01001011+2]).unwrap()+&(i8::MAX-126).to_string();\n  println!(\"{}UNK BYE {}NES\", part_uno, part_dos);\n}",
        }
      };

      function path_to_obj(path) {
        if (path === "/") {
          return file_system;
        } else {
          let dirs = path.split("/");
          //since path starts with "/", remove the empty string at start
          dirs.shift();
          let obj = file_system;
          for (let i=0; i < dirs.length; i++) {
            obj = obj[dirs[i]];
            if (!obj || typeof obj === "string") {
              return false;
            }
          }
          return obj;
        }
      }

      function get_file_contents(path) {
        let dirs = path.split("/");
        //since path starts with "/", remove the empty string at start
        dirs.shift();
        let obj = file_system;
        for (let i=0; i < dirs.length; i++) {
          obj = obj[dirs[i]];
          if (i === dirs.length-1 && typeof obj === "string") {
            return obj;
          }
          if (!obj) {
            return false;
          }
        }
      }

      //terminal
      const SUDO_PASSWORD = "584551CE9EA95ECDC51C60DAC39A046F51BD851453276EA679D031256AF856B2";

      function utf8_to_uint8(utf8) {
        let uint8 = new Uint8Array(utf8.length);
        for (let i=0; i < utf8.length; i++) {
          uint8[i] = utf8.charCodeAt(i);
        }
        return uint8;
      }

      //hex should be even length, obviously
      function hex_to_uint8(hex) {
        let hex_chars = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];
        let uint8 = new Uint8Array(hex.length/2);
        for (let i=0; i < hex.length/2; i++) {
          uint8[i] = hex_chars.indexOf(hex[i])*16+hex_chars.indexOf(hex[i+1]);
        }
        return uint8;
      }

      function uint8_to_hex(uint8) {
        let hex_chars = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];
        let hex = "";
        for (let i=0; i < uint8.length; i++) {
          let first_char = Math.floor(uint8[i]/16);
          let second_char = uint8[i]%16;
          hex += hex_chars[first_char]+hex_chars[second_char];
        }
        return hex;
      }

      let wallpaper_index = 0;

      document.getElementById("terminal-command-input").onkeydown = async (event) => {
        //enter key
        if (event.keyCode === 13) {
          let old_current_path = current_path;
          let value = document.getElementById("terminal-command-input").value;
          document.getElementById("terminal-command-input").value = "";
          let args = value.split(" ");
          let command = args.shift();
          let response;
          if (command === "help") {
            response = "Currently supported commands: help cd ls cat echo pwd wallpaper start music programming minesweeper terminal";
          } else if (command === "pwd") {
            response = current_path;
          } else if (command === "cd") {
            if (args[0]) {
              if (args[0].endsWith("..")) {
                //easier than fixing the root cause
                args[0] += "/";
              }
              if ((args[0].startsWith("../") || args[0] === "..") && old_current_path !== "/") {
                while (true) {
                  let splitted = current_path.split("/");
                  let popped = splitted.pop();
                  if (popped === "") {
                    //the .. was invalid
                    break;
                  }
                  current_path = splitted.join("/");
                  if (current_path === "") {
                    current_path = "/";
                  }
                  //replaces one
                  if (args[0].startsWith("../")) {
                    args[0] = args[0].replace("../", "");
                  } else if (args[0] === "..") {
                    args[0] = "";
                  }
                  if (!args[0].startsWith("../")) break;
                }
              }
            }
            if (current_path.endsWith("/")) {
              current_path += args[0];
            } else if (args[0] !== "") {
              current_path += "/"+args[0];
            }
            if (!path_to_obj(current_path)) {
              current_path = old_current_path;
              response = "Requested path does not exist";
            } else {
              response = "";
            }
          } else if (command === "ls") {
            response = Object.keys(path_to_obj(current_path)).join(", ");
            if (response.trim() === "") {
              response = "Nothing here";
            }
          } else if (command === "echo") {
            response = args.join(" ");
          } else if (command === "cat") {
            if (current_path.endsWith("/")) {
              response = get_file_contents(current_path+args[0]);
            } else {
              response = get_file_contents(current_path+"/"+args[0]);
            }
            if (response === false) {
              response = "Could not find file. `..` are not supported with the cat command";
            }
          } else if (command === "start" || command === "music" || command === "programming" || command === "minesweeper") {
            open_window(false, command);
            response = `Opened ${command}`;
          } else if (command === "terminal") {
            response = "Hmm...";
          } else if (command === "sudo") {
            if (!args[0]) {
              response = "Include password as the first argument"
            } else {
              let hashed = uint8_to_hex(new Uint8Array(await window.crypto.subtle.digest("SHA-256", utf8_to_uint8(args[0]))));
              if (hashed === SUDO_PASSWORD) {
                response = "Success! This does nothing right now.";
              } else if (args[0] === "password") {
                response = "Success! Just kidding. Wrong password.";
              } else {
                response = `Wrong password: ${["remember, all lowercase", "remember, separated by hyphens", "remember, there are four parts, five dashes, six words"][Math.floor(Math.random()*3)]}`;
              }
            }
          } else if (command === "wallpaper") {
            let wallpapers = [
              {
                type: "backgroundColor",
                value: "var(--desktop-background)",
              },
              {
                type: "backgroundColor",
                value: "var(--desktop-background2)",
              },
              {
                type: "backgroundColor",
                value: "var(--desktop-background3)",
              },
              {
                type: "backgroundColor",
                value: "var(--desktop-background4)",
              },
              {
                type: "backgroundColor",
                value: "var(--desktop-background5)",
              },
              {
                type: "backgroundColor",
                value: "white",
              },
              {
                type: "backgroundImage",
                value: "linear-gradient(to right, var(--desktop-background), green)",
              },
              {
                type: "backgroundImage",
                value: "linear-gradient(black, white, black)",
              },
              {
                //the ztmy gradient
                type: "backgroundImage",
                value: "linear-gradient(to right, #BC0ABF, #7D45AA, #47168B)",
              },
            ];
            if (!args[0]) {
              response = "do `wallpaper next` and `wallpaper back` to cycle through desktop wallpapers";
            } else {
              if (args[0] === "next") {
                wallpaper_index++;
                if (wallpaper_index > wallpapers.length-1) {
                  wallpaper_index = 0;
                }
              } else if (args[0] === "back") {
                wallpaper_index--;
                if (wallpaper_index < 0) {
                  wallpaper_index = wallpapers.length-1;
                }
              }
              //reset old wallpaper
              document.getElementById("desktop").style.backgroundImage = "";
              //set new wallpaper
              let new_wallpaper = wallpapers[wallpaper_index];
              document.getElementById("desktop").style[new_wallpaper.type] = new_wallpaper.value;
              response = "Wallpaper changed";
            }
          } else if (command === "npm" && args[0] === "install") {
            response = "[████████] Installing 700000 GB of packages..."
          } else {
            response = "Lo siento, unrecognized command. Type 'help' for a list of commands"
          }
          let result_ele = document.createElement("DIV");
          let command_ele = document.createElement("P");
          command_ele.textContent = `${old_current_path}> ${value}`;
          result_ele.appendChild(command_ele);
          let response_ele = document.createElement("P");
          response_ele.innerText = response;
          result_ele.classList.add("terminal-response");
          result_ele.appendChild(response_ele);
          document.getElementById("terminal-responses").appendChild(result_ele);
          document.getElementById("current-path").textContent = current_path+">";
          document.getElementById("terminal-input-container").style.gridTemplateColumns = `${current_path.length+2}ch auto`;
          let window_content = document.getElementById("terminal-window").querySelector(".window-content");
          window_content.scrollTo(0, window_content.scrollHeight);
        }
      };

      //taskbar start
      document.getElementById("taskbar-start").onclick = () => {
        if (document.getElementById("start-window").style.display === "none") {
          document.getElementById("start-window").style.display = "block";
          create_taskbar_tab("Start");
        }
      };

      create_taskbar_tab("Start");
    </script>
  </body>
</html>